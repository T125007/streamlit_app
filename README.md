# 調査・分析レポート：体力・運動能力の推移

## 1. データ概要
* **統計表名：** 令和6年度 体力・運動能力調査 体力・運動能力の推移
* **データセット名または表番号：** 年齢別テスト項目別平均値（年次推移）
* **データ取得日：** 2024年1月27日

---

## 2. データの構成と定義
### 各列の意味
* **年齢：** 調査対象者の年齢（7歳～19歳）
* **性別：** 調査対象者の性別（男子・女子）
* **S40～R5：** 各年度（昭和40年～令和5年）におけるテスト結果の平均値

### 単位一覧
| 項目 | 単位 |
| :--- | :--- |
| 握力 | kg |
| 上体起こし、20mシャトルラン | 回 |
| 長座体前屈、立ち幅とび | cm |
| 反復横跳び、新体力テストの合計点 | 点 |
| 持久走、50m走 | 秒 |
| ソフトボール投げ、ハンドボール投げ | m |

### データの注意事項
* **欠損値の扱い：** 古い年度や一部の項目において、データが存在しない箇所（CSV内で「…」と表記されている箇所）は、プログラム上で除外（欠損値処理）して計算しています。そのため、一部のグラフで線が途切れたり、平均値のグラフで急激な変化が生じたりすることがあります。

---

## 3. UI設計（Streamlit部品の活用）
アプリの視認性と操作性を高めるため、以下のUI部品を役割ごとに使い分けています。

* **`st.success`（緑色）：**
    * **目的：** データの基本情報を「完了・成功」のニュアンスで提示し、読みやすくするため。
    * **箇所：** アプリ冒頭の「このデータの確認（分析対象や項目）」セクション。
* **`st.info`（青色）：**
    * **目的：** 概要、使い方、分析のヒントを「情報」として強調し、ユーザーをガイドするため。
    * **箇所：** 「概要・目的・使用方法」および各グラフの「傾向を読み取るためのヒント」。
* **`st.divider`：**
    * **目的：** 視覚的な区切り線を引き、情報を整理するため。
    * **箇所：** 「個別の推移グラフ」と「全年齢平均グラフ」の境界。
* **`st.error`（赤色）：**
    * **目的：** データの欠損（…）という注意すべき問題点を警告し、誤解を防ぐため。
    * **箇所：** アプリ最下部の「欠損値に関する注意点」。

---

## 4. データ処理・分析の工夫
正確な分析を行うために実装したプログラミング上のポイントです。

* **`header=1`：**
    * e-StatのCSVは2行目に正しい列名があるため、読み込み開始位置を指定。
* **`iloc` によるスライス：**
    * `iloc[0, 2:]` を使用し、特定の行から不要な「年齢」「性別」列を除外して、年度データのみを抽出。
* **`errors='coerce'`：**
    * `pd.to_numeric` 適用時、欠損値「…」を強制的に `NaN`（空欄）へ変換。これにより、エラーを出さずに計算を継続可能に。
* **`mean()`：**
    * 縦方向（年度ごと）の数値を合計・平均し、全年齢平均の推移データ（yearly_average）を算出。

---

## 5. デザインリファレンス（ギャラリー参照）

### 参照アプリ①：ライフスタイル分析
* **参考点：** ステータスコンテナ（info/success/error）の色の使い分け。
* **反映内容：** 青を「ガイド」、緑を「データ確認」、赤を「欠損値の警告」として一貫性を持って配置。

### 参照アプリ②：Health and Fitness Dashboard
* **参考点：** 画面上部に重要指標（Metric）を並べるレイアウト。
* **反映内容：** 最新年度の平均値を `st.metric` で強調表示し、一目で現状がわかるようにした。

---

## 6. 生成AIの活用
本プロジェクトでは、以下の技術的課題の解決に生成AIを使用しました。

1.  **データ読み込み：** CSVの1行目ではなく2行目に正しい列名があるため、2行目を指定する方法を参考にした。(header=1)
2.  **データ抽出：** 年度の数字だけを抜き出すやり方を知りたくて、不要な「年齢」「性別」を除くための関数を参考にした。（iloc）
3.  **エラー回避：** errors='coerce':年代ごとの平均値を計算を行おうと思ったが、「…」によってエラーが発生してしまった。このエラーを解決するために生成AIしてerrors='coerce'を使用することによって解決すると分かった。具体的には、これが「掃除」の役割をしていて、「もし数字じゃないもの（… ）があったら、無理やり空っぽ（NaN）にして無視しろ」という指示してくれる。これにより「…」空っぽ扱いされ無視されるのでエラーなく平均値の計算ができる。
4.  **統計計算：** 平均値の計算をする関数が知りたくて、表の中にある数字を縦方向に計算する方法を参考した（mean()）