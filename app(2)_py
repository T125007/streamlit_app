import streamlit as st
import pandas as pd
import plotly.express as px

st.set_page_config(page_title='ä½“åŠ›é‹å‹•èƒ½åŠ›ã®æ¨ç§»', layout='wide')
st.title('ğŸƒ é’å¹´ã®å¹´ä»£åˆ¥ ä½“åŠ›é‹å‹•èƒ½åŠ›ã®æ¨ç§»')

file_map = {
    "æ¡åŠ›": "akuryoku.csv", "50mèµ°": "50msou.csv", "ãƒãƒ³ãƒ‰ãƒœãƒ¼ãƒ«æŠ•ã’": "handball.csv",
    "åå¾©æ¨ªã¨ã³": "hannpukuyokotobi.csv", "ä¸Šä½“èµ·ã“ã—": "jyoutaiokosi.csv",
    "ã‚½ãƒ•ãƒˆãƒœãƒ¼ãƒ«æŠ•ã’": "softball.csv", "20mã‚·ãƒ£ãƒˆãƒ«ãƒ©ãƒ³": "syatorurann.csv",
    "ç«‹ã¡å¹…ã¨ã³": "tatohabatobi.csv", "é•·åº§ä½“å‰å±ˆ": "tyouzataizennkutu.csv", "æŒä¹…èµ°": "zikyuusou.csv"
}

with st.sidebar:
    st.header('è¡¨ç¤ºè¨­å®š')
    selected_event_name = st.selectbox('ç¨®ç›®ã‚’é¸æŠã—ã¦ãã ã•ã„', list(file_map.keys()))
    target_gender = st.radio("æ€§åˆ¥", ["ç”·å­", "å¥³å­"])

# --- ã“ã“ã‹ã‚‰ä¸‹ã‚’ã‚·ãƒ³ãƒ—ãƒ«ã« ---

# 1. ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ï¼ˆ2è¡Œç›®ã‚’ãƒ˜ãƒƒãƒ€ãƒ¼ã«ã™ã‚‹ï¼‰
file_path = file_map[selected_event_name]
df = pd.read_csv(file_path, header=1)

# 2. åˆ—åã®æ•´ç†ï¼ˆæœ€åˆã®2åˆ—ã‚’å›ºå®šï¼‰
df.columns.values[0] = "å¹´é½¢"
df.columns.values[1] = "æ€§åˆ¥"

# 3. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒé¸ã‚“ã ã€Œæ€§åˆ¥ã€ã§çµã‚Šè¾¼ã¿
df_selection = df[df["æ€§åˆ¥"] == target_gender]

# 4. å¹´é½¢ã‚’é¸ã‚“ã§ã‚‚ã‚‰ã†ï¼ˆä¾‹ï¼š13æ­³ã€19æ­³ãªã©ï¼‰
target_age = st.selectbox("å¹´é½¢ã‚’é¸æŠã—ã¦ãã ã•ã„", df_selection["å¹´é½¢"].unique())

# 5. ã‚°ãƒ©ãƒ•ç”¨ã®ãƒ‡ãƒ¼ã‚¿æŠ½å‡ºï¼ˆé¸ã‚“ã å¹´é½¢ã®è¡Œã‚’å–ã‚Šå‡ºã—ã€å¹´åº¦ã¨è¨˜éŒ²ã‚’å¯¾å¿œã•ã›ã‚‹ï¼‰
row = df_selection[df_selection["å¹´é½¢"] == target_age]

# ã‚°ãƒ©ãƒ•åŒ–ã™ã‚‹ãŸã‚ã«ã€å¹´åº¦ã®åˆ—ã¨è¨˜éŒ²ã®å€¤ã ã‘ã‚’æŠœãå‡ºã™
years = df.columns[2:]  # S40, 45... ãªã©ã®å¹´åº¦åˆ—
values = row.iloc[0, 2:] # ãã®å¹´åº¦ã«å¯¾å¿œã™ã‚‹æ•°å€¤ãƒ‡ãƒ¼ã‚¿

# 6. è¡¨ç¤º
st.subheader(f"{target_age} {target_gender} ã® {selected_event_name} æ¨ç§»")

# Plotlyã§æç”»ï¼ˆxè»¸ã«å¹´åº¦ã€yè»¸ã«è¨˜éŒ²ï¼‰
fig = px.line(x=years, y=values, markers=True, labels={'x':'å¹´åº¦', 'y':'è¨˜éŒ²'})
st.plotly_chart(fig, use_container_width=True)

# è¡¨ã‚‚è¦‹ã›ã‚‹
st.write("å…ƒãƒ‡ãƒ¼ã‚¿ï¼ˆé¸æŠä¸­ã®ä¸€è¡Œï¼‰")
st.dataframe(row)